package main

import (
	"fmt"
	"io/ioutil"
	"net/smtp"
	"strconv"
	"strings"
)

func main() {
	// Read /proc/uptime
	data, err := ioutil.ReadFile("/proc/uptime")
	if err != nil {
		fmt.Println("Error reading /proc/uptime:", err)
		return
	}

	// Parse uptime in seconds
	fields := strings.Fields(string(data))
	uptimeSeconds, err := strconv.ParseFloat(fields[0], 64)
	if err != nil {
		fmt.Println("Error parsing uptime:", err)
		return
	}

	// Convert to days
	uptimeDays := int(uptimeSeconds / 86400)

	// Check threshold
	if uptimeDays > 10 {
		sendAlertEmail(uptimeDays)
	}
}

func sendAlertEmail(uptimeDays int) {
	from := "monitor@example.com"
	to := "admin@example.com"
	subject := "Subject: Uptime Alert\n"
	body := fmt.Sprintf("Alert: Uptime exceeds 10 days (currently %d days)\n", uptimeDays)
	msg := []byte(subject + "\n" + body)

	// Adjust SMTP settings as needed
	err := smtp.SendMail("localhost:25", nil, from, []string{to}, msg)
	if err != nil {
		fmt.Println("Failed to send email:", err)
	} else {
		fmt.Println("Alert email sent.")
	}
}
